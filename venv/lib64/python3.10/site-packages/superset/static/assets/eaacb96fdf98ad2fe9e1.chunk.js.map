{"version":3,"file":"eaacb96fdf98ad2fe9e1.chunk.js","mappings":"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","sources":["webpack://superset/./packages/superset-ui-core/src/utils/html.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/components/Tooltip.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/TooltipRow.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/components/Legend.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/factory.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/common.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/colors.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/computeBoundsFromPoints.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/fitViewport.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/sandbox.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { FilterXSS, getDefaultWhiteList } from 'xss';\n\nconst xssFilter = new FilterXSS({\n  whiteList: {\n    ...getDefaultWhiteList(),\n    span: ['style', 'class', 'title'],\n    div: ['style', 'class'],\n    a: ['style', 'class', 'href', 'title', 'target'],\n    img: ['style', 'class', 'src', 'alt', 'title', 'width', 'height'],\n    video: [\n      'autoplay',\n      'controls',\n      'loop',\n      'preload',\n      'src',\n      'height',\n      'width',\n      'muted',\n    ],\n  },\n  stripIgnoreTag: true,\n  css: false,\n});\n\nexport function sanitizeHtml(htmlString: string) {\n  return xssFilter.process(htmlString);\n}\n\nexport function isProbablyHTML(text: string) {\n  return Array.from(\n    new DOMParser().parseFromString(text, 'text/html').body.childNodes,\n  ).some(({ nodeType }) => nodeType === 1);\n}\n\nexport function sanitizeHtmlIfNeeded(htmlString: string) {\n  return isProbablyHTML(htmlString) ? sanitizeHtml(htmlString) : htmlString;\n}\n\nexport function safeHtmlSpan(possiblyHtmlString: string) {\n  const isHtml = isProbablyHTML(possiblyHtmlString);\n  if (isHtml) {\n    return (\n      <span\n        className=\"safe-html-wrapper\"\n        dangerouslySetInnerHTML={{ __html: sanitizeHtml(possiblyHtmlString) }}\n      />\n    );\n  }\n  return possiblyHtmlString;\n}\n\nexport function removeHTMLTags(str: string): string {\n  return str.replace(/<[^>]*>/g, '');\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled, safeHtmlSpan } from '@superset-ui/core';\nimport React, { ReactNode } from 'react';\n\nexport type TooltipProps = {\n  tooltip:\n    | {\n        x: number;\n        y: number;\n        content: ReactNode;\n      }\n    | null\n    | undefined;\n};\n\nconst StyledDiv = styled.div<{ top: number; left: number }>`\n  ${({ theme, top, left }) => `\n    position: absolute;\n    top: ${top}px;\n    left: ${left}px;\n    padding: ${theme.gridUnit * 2}px;\n    margin: ${theme.gridUnit * 2}px;\n    background: ${theme.colors.grayscale.dark2};\n    color: ${theme.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${theme.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}\n`;\n\nexport default function Tooltip(props: TooltipProps) {\n  const { tooltip } = props;\n  if (typeof tooltip === 'undefined' || tooltip === null) {\n    return null;\n  }\n\n  const { x, y, content } = tooltip;\n  const safeContent =\n    typeof content === 'string' ? safeHtmlSpan(content) : content;\n\n  return (\n    <StyledDiv top={y} left={x}>\n      {safeContent}\n    </StyledDiv>\n  );\n}\n","/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  forwardRef,\n  memo,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { isEqual } from 'lodash';\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL, { Layer } from 'deck.gl/typed';\nimport { JsonObject, JsonValue, styled, usePrevious } from '@superset-ui/core';\nimport Tooltip, { TooltipProps } from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { Viewport } from './utils/fitViewport';\n\nconst TICK = 250; // milliseconds\n\nexport type DeckGLContainerProps = {\n  viewport: Viewport;\n  setControlValue?: (control: string, value: JsonValue) => void;\n  mapStyle?: string;\n  mapboxApiAccessToken: string;\n  children?: ReactNode;\n  width: number;\n  height: number;\n  layers: (Layer | (() => Layer))[];\n  onViewportChange?: (viewport: Viewport) => void;\n};\n\nexport const DeckGLContainer = memo(\n  forwardRef((props: DeckGLContainerProps, ref) => {\n    const [tooltip, setTooltip] = useState<TooltipProps['tooltip']>(null);\n    const [lastUpdate, setLastUpdate] = useState<number | null>(null);\n    const [viewState, setViewState] = useState(props.viewport);\n    const prevViewport = usePrevious(props.viewport);\n\n    useImperativeHandle(ref, () => ({ setTooltip }), []);\n\n    const tick = useCallback(() => {\n      // Rate limiting updating viewport controls as it triggers lots of renders\n      if (lastUpdate && Date.now() - lastUpdate > TICK) {\n        const setCV = props.setControlValue;\n        if (setCV) {\n          setCV('viewport', viewState);\n        }\n        setLastUpdate(null);\n      }\n    }, [lastUpdate, props.setControlValue, viewState]);\n\n    useEffect(() => {\n      const timer = setInterval(tick, TICK);\n      return clearInterval(timer);\n    }, [tick]);\n\n    useEffect(() => {\n      if (!isEqual(props.viewport, prevViewport)) {\n        setViewState(props.viewport);\n      }\n    }, [prevViewport, props.viewport]);\n\n    const onViewStateChange = useCallback(\n      ({ viewState }: { viewState: JsonObject }) => {\n        setViewState(viewState as Viewport);\n        setLastUpdate(Date.now());\n      },\n      [],\n    );\n\n    const layers = useCallback(() => {\n      // Support for layer factory\n      if (props.layers.some(l => typeof l === 'function')) {\n        return props.layers.map(l =>\n          typeof l === 'function' ? l() : l,\n        ) as Layer[];\n      }\n\n      return props.layers as Layer[];\n    }, [props.layers]);\n\n    const { children = null, height, width } = props;\n\n    return (\n      <>\n        <div style={{ position: 'relative', width, height }}>\n          <DeckGL\n            controller\n            width={width}\n            height={height}\n            layers={layers()}\n            viewState={viewState}\n            glOptions={{ preserveDrawingBuffer: true }}\n            onViewStateChange={onViewStateChange}\n          >\n            <StaticMap\n              preserveDrawingBuffer\n              mapStyle={props.mapStyle || 'light'}\n              mapboxApiAccessToken={props.mapboxApiAccessToken}\n            />\n          </DeckGL>\n          {children}\n        </div>\n        <Tooltip tooltip={tooltip} />\n      </>\n    );\n  }),\n);\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n\nexport type DeckGLContainerHandle = typeof DeckGLContainer & {\n  setTooltip: (tooltip: ReactNode) => void;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\ntype TooltipRowProps = {\n  label: string;\n  value: string;\n};\n\nconst TooltipRow = ({ label, value }: TooltipRowProps) => (\n  <div>\n    {label}\n    <strong>{value}</strong>\n  </div>\n);\n\nexport default TooltipRow;\n","/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable jsx-a11y/anchor-is-valid */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { memo } from 'react';\nimport { formatNumber, styled } from '@superset-ui/core';\n\nconst StyledLegend = styled.div`\n  ${({ theme }) => `\n    font-size: ${theme.typography.sizes.s}px;\n    position: absolute;\n    background: ${theme.colors.grayscale.light5};\n    box-shadow: 0 0 ${theme.gridUnit}px ${theme.colors.grayscale.light2};\n    margin: ${theme.gridUnit * 6}px;\n    padding: ${theme.gridUnit * 3}px ${theme.gridUnit * 5}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        color: ${theme.colors.grayscale.base};\n        text-decoration: none;\n\n        & span {\n          margin-right: ${theme.gridUnit * 3}px;\n        }\n      }\n    }\n  `}\n`;\n\nconst categoryDelimiter = ' - ';\n\nexport type LegendProps = {\n  format: string | null;\n  forceCategorical?: boolean;\n  position?: null | 'tl' | 'tr' | 'bl' | 'br';\n  categories: Record<string, { enabled: boolean; color: number[] }>;\n  toggleCategory?: (key: string) => void;\n  showSingleCategory?: (key: string) => void;\n};\n\nconst Legend = ({\n  format: d3Format = null,\n  forceCategorical = false,\n  position = 'tr',\n  categories: categoriesObject = {},\n  toggleCategory = () => {},\n  showSingleCategory = () => {},\n}: LegendProps) => {\n  const format = (value: string) => {\n    if (!d3Format || forceCategorical) {\n      return value;\n    }\n\n    const numValue = parseFloat(value);\n\n    return formatNumber(d3Format, numValue);\n  };\n\n  const formatCategoryLabel = (k: string) => {\n    if (!d3Format) {\n      return k;\n    }\n\n    if (k.includes(categoryDelimiter)) {\n      const values = k.split(categoryDelimiter);\n\n      return format(values[0]) + categoryDelimiter + format(values[1]);\n    }\n\n    return format(k);\n  };\n\n  if (Object.keys(categoriesObject).length === 0 || position === null) {\n    return null;\n  }\n\n  const categories = Object.entries(categoriesObject).map(([k, v]) => {\n    const style = { color: `rgba(${v.color.join(', ')})` };\n    const icon = v.enabled ? '\\u25FC' : '\\u25FB';\n\n    return (\n      <li key={k}>\n        <a\n          href=\"#\"\n          onClick={() => toggleCategory(k)}\n          onDoubleClick={() => showSingleCategory(k)}\n        >\n          <span style={style}>{icon}</span> {formatCategoryLabel(k)}\n        </a>\n      </li>\n    );\n  });\n\n  const vertical = position?.charAt(0) === 't' ? 'top' : 'bottom';\n  const horizontal = position?.charAt(1) === 'r' ? 'right' : 'left';\n  const style = {\n    position: 'absolute' as const,\n    [vertical]: '0px',\n    [horizontal]: '10px',\n  };\n\n  return (\n    <StyledLegend className=\"dupa\" style={style}>\n      <ul>{categories}</ul>\n    </StyledLegend>\n  );\n};\n\nexport default memo(Legend);\n","/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/require-default-props */\n/* eslint-disable react/no-unused-prop-types */\n/* eslint-disable react/no-access-state-in-setstate */\n/* eslint-disable camelcase */\n/* eslint-disable no-prototype-builtins */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-underscore-dangle: [\"error\", { \"allow\": [\"\", \"__timestamp\"] }] */\n\nimport React, { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport {\n  CategoricalColorNamespace,\n  Datasource,\n  HandlerFunction,\n  JsonObject,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { Layer } from 'deck.gl/typed';\nimport Legend from './components/Legend';\nimport { hexToRGB } from './utils/colors';\nimport sandboxedEval from './utils/sandbox';\n// eslint-disable-next-line import/extensions\nimport fitViewport, { Viewport } from './utils/fitViewport';\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from './DeckGLContainer';\nimport { Point } from './types';\nimport { getLayerType } from './factory';\nimport { TooltipProps } from './components/Tooltip';\n\nconst { getScale } = CategoricalColorNamespace;\n\nfunction getCategories(fd: QueryFormData, data: JsonObject[]) {\n  const c = fd.color_picker || { r: 0, g: 0, b: 0, a: 1 };\n  const fixedColor = [c.r, c.g, c.b, 255 * c.a];\n  const colorFn = getScale(fd.color_scheme);\n  const categories = {};\n  data.forEach(d => {\n    if (d.cat_color != null && !categories.hasOwnProperty(d.cat_color)) {\n      let color;\n      if (fd.dimension) {\n        color = hexToRGB(colorFn(d.cat_color, fd.sliceId), c.a * 255);\n      } else {\n        color = fixedColor;\n      }\n      categories[d.cat_color] = { color, enabled: true };\n    }\n  });\n\n  return categories;\n}\n\nexport type CategoricalDeckGLContainerProps = {\n  datasource: Datasource;\n  formData: QueryFormData;\n  mapboxApiKey: string;\n  getPoints: (data: JsonObject[]) => Point[];\n  height: number;\n  width: number;\n  viewport: Viewport;\n  getLayer: getLayerType<unknown>;\n  payload: JsonObject;\n  onAddFilter?: HandlerFunction;\n  setControlValue: (control: string, value: JsonValue) => void;\n};\n\nconst CategoricalDeckGLContainer = (props: CategoricalDeckGLContainerProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>(null);\n\n  const getAdjustedViewport = useCallback(() => {\n    let viewport = { ...props.viewport };\n    if (props.formData.autozoom) {\n      viewport = fitViewport(viewport, {\n        width: props.width,\n        height: props.height,\n        points: props.getPoints(props.payload.data.features || []),\n      });\n    }\n    if (viewport.zoom < 0) {\n      viewport.zoom = 0;\n    }\n    return viewport;\n  }, [props]);\n\n  const [categories, setCategories] = useState<JsonObject>(\n    getCategories(props.formData, props.payload.data.features || []),\n  );\n  const [stateFormData, setStateFormData] = useState<JsonObject>(\n    props.payload.form_data,\n  );\n  const [viewport, setViewport] = useState(getAdjustedViewport());\n\n  useEffect(() => {\n    if (props.payload.form_data !== stateFormData) {\n      const features = props.payload.data.features || [];\n      const categories = getCategories(props.formData, features);\n\n      setViewport(getAdjustedViewport());\n      setStateFormData(props.payload.form_data);\n      setCategories(categories);\n    }\n  }, [getAdjustedViewport, props, stateFormData]);\n\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const addColor = useCallback((data: JsonObject[], fd: QueryFormData) => {\n    const c = fd.color_picker || { r: 0, g: 0, b: 0, a: 1 };\n    const colorFn = getScale(fd.color_scheme);\n\n    return data.map(d => {\n      let color;\n      if (fd.dimension) {\n        color = hexToRGB(colorFn(d.cat_color, fd.sliceId), c.a * 255);\n\n        return { ...d, color };\n      }\n\n      return d;\n    });\n  }, []);\n\n  const getLayers = useCallback(() => {\n    const { getLayer, payload, formData: fd, onAddFilter } = props;\n    let features = payload.data.features ? [...payload.data.features] : [];\n\n    // Add colors from categories or fixed color\n    features = addColor(features, fd);\n\n    // Apply user defined data mutator if defined\n    if (fd.js_data_mutator) {\n      const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n      features = jsFnMutator(features);\n    }\n\n    // Show only categories selected in the legend\n    if (fd.dimension) {\n      features = features.filter(d => categories[d.cat_color]?.enabled);\n    }\n\n    const filteredPayload = {\n      ...payload,\n      data: { ...payload.data, features },\n    };\n\n    return [\n      getLayer(\n        fd,\n        filteredPayload,\n        onAddFilter,\n        setTooltip,\n        props.datasource,\n      ) as Layer,\n    ];\n  }, [addColor, categories, props, setTooltip]);\n\n  const toggleCategory = useCallback(\n    (category: string) => {\n      const categoryState = categories[category];\n      const categoriesExtended = {\n        ...categories,\n        [category]: {\n          ...categoryState,\n          enabled: !categoryState.enabled,\n        },\n      };\n\n      // if all categories are disabled, enable all -- similar to nvd3\n      if (Object.values(categoriesExtended).every(v => !v.enabled)) {\n        /* eslint-disable no-param-reassign */\n        Object.values(categoriesExtended).forEach(v => {\n          v.enabled = true;\n        });\n      }\n      setCategories(categoriesExtended);\n    },\n    [categories],\n  );\n\n  const showSingleCategory = useCallback(\n    (category: string) => {\n      const modifiedCategories = { ...categories };\n      Object.values(modifiedCategories).forEach(v => {\n        v.enabled = false;\n      });\n      modifiedCategories[category].enabled = true;\n      setCategories(modifiedCategories);\n    },\n    [categories],\n  );\n\n  return (\n    <div style={{ position: 'relative' }}>\n      <DeckGLContainerStyledWrapper\n        ref={containerRef}\n        viewport={viewport}\n        layers={getLayers()}\n        setControlValue={props.setControlValue}\n        mapStyle={props.formData.mapbox_style}\n        mapboxApiAccessToken={props.mapboxApiKey}\n        width={props.width}\n        height={props.height}\n      />\n      <Legend\n        forceCategorical\n        categories={categories}\n        format={props.formData.legend_format}\n        position={props.formData.legend_position}\n        showSingleCategory={showSingleCategory}\n        toggleCategory={toggleCategory}\n      />\n    </div>\n  );\n};\n\nexport default memo(CategoricalDeckGLContainer);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { isEqual } from 'lodash';\nimport { Layer } from 'deck.gl/typed';\nimport {\n  Datasource,\n  QueryFormData,\n  JsonObject,\n  HandlerFunction,\n  usePrevious,\n} from '@superset-ui/core';\n\nimport {\n  DeckGLContainerStyledWrapper,\n  DeckGLContainerHandle,\n} from './DeckGLContainer';\nimport CategoricalDeckGLContainer from './CategoricalDeckGLContainer';\nimport fitViewport, { Viewport } from './utils/fitViewport';\nimport { Point } from './types';\nimport { TooltipProps } from './components/Tooltip';\n\ntype deckGLComponentProps = {\n  datasource: Datasource;\n  formData: QueryFormData;\n  height: number;\n  onAddFilter: HandlerFunction;\n  payload: JsonObject;\n  setControlValue: () => void;\n  viewport: Viewport;\n  width: number;\n};\nexport interface getLayerType<T> {\n  (\n    formData: QueryFormData,\n    payload: JsonObject,\n    onAddFilter: HandlerFunction | undefined,\n    setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n    datasource?: Datasource,\n  ): T;\n}\ninterface getPointsType {\n  (data: JsonObject[]): Point[];\n}\n\nexport function createDeckGLComponent(\n  getLayer: getLayerType<unknown>,\n  getPoints: getPointsType,\n) {\n  // Higher order component\n  return memo((props: deckGLComponentProps) => {\n    const containerRef = useRef<DeckGLContainerHandle>();\n    const prevFormData = usePrevious(props.formData);\n    const prevPayload = usePrevious(props.payload);\n    const getAdjustedViewport = () => {\n      const { width, height, formData } = props;\n      if (formData.autozoom) {\n        return fitViewport(props.viewport, {\n          width,\n          height,\n          points: getPoints(props.payload.data.features),\n        }) as Viewport;\n      }\n      return props.viewport;\n    };\n\n    const [viewport, setViewport] = useState(getAdjustedViewport());\n\n    const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n      const { current } = containerRef;\n      if (current) {\n        current?.setTooltip(tooltip);\n      }\n    }, []);\n\n    const computeLayer = useCallback(\n      (props: deckGLComponentProps) => {\n        const { formData, payload, onAddFilter } = props;\n\n        return getLayer(formData, payload, onAddFilter, setTooltip) as Layer;\n      },\n      [setTooltip],\n    );\n\n    const [layer, setLayer] = useState(computeLayer(props));\n\n    useEffect(() => {\n      // Only recompute the layer if anything BUT the viewport has changed\n      const prevFdNoVP = { ...prevFormData, viewport: null };\n      const currFdNoVP = { ...props.formData, viewport: null };\n      if (!isEqual(prevFdNoVP, currFdNoVP) || prevPayload !== props.payload) {\n        setLayer(computeLayer(props));\n      }\n    }, [computeLayer, prevFormData, prevPayload, props]);\n\n    const { formData, payload, setControlValue, height, width } = props;\n\n    return (\n      <DeckGLContainerStyledWrapper\n        ref={containerRef}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        viewport={viewport}\n        layers={[layer]}\n        mapStyle={formData.mapbox_style}\n        setControlValue={setControlValue}\n        width={width}\n        height={height}\n        onViewportChange={setViewport}\n      />\n    );\n  });\n}\n\nexport function createCategoricalDeckGLComponent(\n  getLayer: getLayerType<Layer>,\n  getPoints: getPointsType,\n) {\n  return function Component(props: deckGLComponentProps) {\n    const {\n      datasource,\n      formData,\n      height,\n      payload,\n      setControlValue,\n      viewport,\n      width,\n    } = props;\n\n    return (\n      <CategoricalDeckGLContainer\n        datasource={datasource}\n        formData={formData}\n        mapboxApiKey={payload.data.mapboxApiKey}\n        setControlValue={setControlValue}\n        viewport={viewport}\n        getLayer={getLayer}\n        payload={payload}\n        getPoints={getPoints}\n        width={width}\n        height={height}\n      />\n    );\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport * as d3array from 'd3-array';\nimport { JsonObject, JsonValue, QueryFormData } from '@superset-ui/core';\nimport sandboxedEval from '../utils/sandbox';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport function commonLayerProps(\n  formData: QueryFormData,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  setTooltipContent: (content: JsonObject) => ReactNode,\n  onSelect?: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o: JsonObject) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o: any) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o: any) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(\n  type = 'sum',\n  accessor: ((object: any) => number | undefined) | null = null,\n) {\n  if (type === 'count') {\n    return (arr: number[]) => arr.length;\n  }\n  let d3func: (\n    iterable: Array<unknown>,\n    accessor?: (object: JsonObject) => number | undefined,\n  ) => number[] | number | undefined;\n  if (type in percentiles) {\n    d3func = (arr, acc: (object: JsonObject) => number | undefined) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1: JsonObject, o2: JsonObject) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr: JsonObject[]) => d3func(arr);\n  }\n\n  return (arr: JsonObject[]) => d3func(arr.map(x => accessor(x)));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { rgb } from 'd3-color';\n\n// eslint-disable-next-line import/prefer-default-export\nexport function hexToRGB(\n  hex: string | undefined,\n  alpha = 255,\n): [number, number, number, number] {\n  if (!hex) {\n    return [0, 0, 0, alpha];\n  }\n  const { r, g, b } = rgb(hex);\n\n  return [r, g, b, alpha];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { extent as d3Extent } from 'd3-array';\nimport { Point, Range } from '../types';\n\nconst LAT_LIMIT: Range = [-90, 90];\nconst LNG_LIMIT: Range = [-180, 180];\n\n/**\n * Expand a coordinate range by `padding` and within limits, if needed\n */\nfunction expandIfNeeded(\n  [curMin, curMax]: Range,\n  [minBound, maxBound]: Range,\n  padding = 0.25,\n) {\n  return curMin < curMax\n    ? [curMin, curMax]\n    : [\n        Math.max(minBound, curMin - padding),\n        Math.min(maxBound, curMax + padding),\n      ];\n}\n\nexport default function computeBoundsFromPoints(\n  points: Point[],\n): [Point, Point] {\n  const latBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[1]) as Range,\n    LAT_LIMIT,\n  );\n  const lngBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[0]) as Range,\n    LNG_LIMIT,\n  );\n  return [\n    [lngBounds[0], latBounds[0]],\n    [lngBounds[1], latBounds[1]],\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { fitBounds } from '@math.gl/web-mercator';\nimport computeBoundsFromPoints from './computeBoundsFromPoints';\nimport { Point } from '../types';\n\nexport type Viewport = {\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  bearing?: number;\n  pitch?: number;\n};\n\nexport type FitViewportOptions = {\n  points: Point[];\n  width: number;\n  height: number;\n  minExtent?: number;\n  maxZoom?: number;\n  offset?: [number, number];\n  padding?: number;\n};\n\nexport default function fitViewport(\n  originalViewPort: Viewport,\n  {\n    points,\n    width,\n    height,\n    minExtent,\n    maxZoom,\n    offset,\n    padding = 20,\n  }: FitViewportOptions,\n): Viewport {\n  const { bearing, pitch } = originalViewPort;\n  const bounds = computeBoundsFromPoints(points);\n\n  try {\n    return {\n      ...fitBounds({\n        bounds,\n        width,\n        height,\n        minExtent,\n        maxZoom,\n        offset,\n        padding,\n      }),\n      bearing,\n      pitch,\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Could not fit viewport', error);\n  }\n\n  return originalViewPort;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// A safe alternative to JS's eval\nimport vm, { Context, RunningScriptOptions } from 'vm';\nimport _ from 'underscore';\nimport * as d3array from 'd3-array';\nimport * as colors from './colors';\n\n// Objects exposed here should be treated like a public API\n// if `underscore` had backwards incompatible changes in a future release, we'd\n// have to be careful about bumping the library as those changes could break user charts\nconst GLOBAL_CONTEXT = {\n  console,\n  _,\n  colors,\n  d3array,\n};\n\n// Copied/modified from https://github.com/hacksparrow/safe-eval/blob/master/index.js\nexport default function sandboxedEval(\n  code: string,\n  context?: Context,\n  opts?: RunningScriptOptions | string,\n) {\n  const sandbox = {};\n  const resultKey = `SAFE_EVAL_${Math.floor(Math.random() * 1000000)}`;\n  sandbox[resultKey] = {};\n  const codeToEval = `${resultKey}=${code}`;\n  const sandboxContext = { ...GLOBAL_CONTEXT, ...context };\n  Object.keys(sandboxContext).forEach(key => {\n    sandbox[key] = sandboxContext[key];\n  });\n  try {\n    vm.runInNewContext(codeToEval, sandbox, opts);\n\n    return sandbox[resultKey];\n  } catch (error) {\n    return () => error;\n  }\n}\n"],"names":["xssFilter","FilterXSS","whiteList","getDefaultWhiteList","span","div","a","img","video","stripIgnoreTag","css","sanitizeHtml","htmlString","process","isProbablyHTML","text","Array","from","DOMParser","parseFromString","body","childNodes","some","nodeType","sanitizeHtmlIfNeeded","safeHtmlSpan","possiblyHtmlString","___EmotionJSX","className","dangerouslySetInnerHTML","__html","removeHTMLTags","str","replace","StyledDiv","styled","theme","top","left","gridUnit","colors","grayscale","dark2","light5","typography","sizes","s","Tooltip","props","tooltip","x","y","content","safeContent","DeckGLContainer","memo","forwardRef","ref","setTooltip","useState","lastUpdate","setLastUpdate","viewState","setViewState","viewport","prevViewport","usePrevious","useImperativeHandle","tick","useCallback","Date","now","setCV","setControlValue","useEffect","timer","setInterval","clearInterval","_isEqual","onViewStateChange","layers","l","map","children","height","width","React","style","position","DeckGL","controller","glOptions","preserveDrawingBuffer","StaticMap","mapStyle","mapboxApiAccessToken","DeckGLContainerStyledWrapper","TooltipRow","label","value","StyledLegend","light2","base","categoryDelimiter","Legend","format","d3Format","forceCategorical","categories","categoriesObject","toggleCategory","showSingleCategory","numValue","parseFloat","formatNumber","Object","keys","length","entries","k","v","color","join","icon","enabled","key","href","onClick","onDoubleClick","formatCategoryLabel","includes","values","split","charAt","getScale","CategoricalColorNamespace","getCategories","fd","data","c","color_picker","r","g","b","fixedColor","colorFn","color_scheme","forEach","d","cat_color","hasOwnProperty","dimension","hexToRGB","sliceId","CategoricalDeckGLContainer","containerRef","useRef","getAdjustedViewport","formData","autozoom","fitViewport","points","getPoints","payload","features","zoom","setCategories","stateFormData","setStateFormData","form_data","setViewport","current","addColor","getLayers","getLayer","onAddFilter","js_data_mutator","sandboxedEval","jsFnMutator","filter","_categories$d$cat_col","datasource","category","categoryState","categoriesExtended","every","modifiedCategories","mapbox_style","mapboxApiKey","legend_format","legend_position","createDeckGLComponent","prevFormData","prevPayload","computeLayer","layer","setLayer","prevFdNoVP","currFdNoVP","onViewportChange","createCategoricalDeckGLComponent","commonLayerProps","setTooltipContent","onSelect","onHover","tooltipContentGenerator","js_tooltip","o","picked","js_onclick_href","window","open","table_filter","undefined","object","line_column","pickable","Boolean","percentiles","p1","p5","p95","p99","getAggFunc","type","accessor","arr","d3func","acc","sortedArr","sort","o1","o2","d3array","hex","alpha","rgb","LAT_LIMIT","LNG_LIMIT","expandIfNeeded","curMin","curMax","minBound","maxBound","padding","Math","max","min","originalViewPort","minExtent","maxZoom","offset","bearing","pitch","bounds","latBounds","d3Extent","lngBounds","computeBoundsFromPoints","fitBounds","error","console","GLOBAL_CONTEXT","_","code","context","opts","sandbox","resultKey","floor","random","codeToEval","sandboxContext","vm"],"sourceRoot":""}