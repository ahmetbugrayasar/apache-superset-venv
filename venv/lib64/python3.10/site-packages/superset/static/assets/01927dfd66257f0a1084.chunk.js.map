{"version":3,"file":"01927dfd66257f0a1084.chunk.js","mappings":"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","sources":["webpack://superset/../../../src/lib/composite-layer.ts","webpack://superset/./packages/superset-ui-core/src/utils/html.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/components/Tooltip.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/TooltipRow.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Geojson/Geojson.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/common.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/colors.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/computeBoundsFromPoints.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/fitViewport.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/sandbox.ts"],"sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport Layer, {UpdateParameters} from './layer';\nimport debug from '../debug';\nimport {flatten} from '../utils/flatten';\n\nimport type AttributeManager from './attribute/attribute-manager';\nimport type {PickingInfo, GetPickingInfoParams} from './picking/pick-info';\nimport type {FilterContext} from '../passes/layers-pass';\nimport type {LayersList, LayerContext} from './layer-manager';\nimport type {CompositeLayerProps, Accessor, AccessorContext} from '../types/layer-props';\nimport {ConstructorOf} from '../types/types';\nimport {PROP_TYPES_SYMBOL} from '../lifecycle/constants';\n\nconst TRACE_RENDER_LAYERS = 'compositeLayer.renderLayers';\n\nexport default abstract class CompositeLayer<PropsT extends {} = {}> extends Layer<\n  PropsT & Required<CompositeLayerProps>\n> {\n  static layerName: string = 'CompositeLayer';\n\n  /** `true` if this layer renders other layers */\n  get isComposite(): boolean {\n    return true;\n  }\n\n  /** Returns true if all async resources are loaded */\n  get isLoaded(): boolean {\n    return super.isLoaded && this.getSubLayers().every(layer => layer.isLoaded);\n  }\n\n  /** Return last rendered sub layers */\n  getSubLayers(): Layer[] {\n    return (this.internalState && this.internalState.subLayers) || [];\n  }\n\n  // initializeState is usually not needed for composite layers\n  // Provide empty definition to disable check for missing definition\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  initializeState(context: LayerContext): void {}\n\n  /** Updates selected state members and marks the composite layer to need rerender */\n  setState(updateObject: any): void {\n    super.setState(updateObject);\n    // Trigger a layer update\n    // Although conceptually layer.draw and compositeLayer.renderLayers are equivalent,\n    // they are executed during different lifecycles.\n    // draw can be called without calling updateState (e.g. most viewport changes),\n    // while renderLayers can only be called during a recursive layer update.\n    this.setNeedsUpdate();\n  }\n\n  /** called to augment the info object that is bubbled up from a sublayer\n      override Layer.getPickingInfo() because decoding / setting uniform do\n      not apply to a composite layer. */\n  getPickingInfo({info}: GetPickingInfoParams): PickingInfo {\n    const {object} = info;\n    const isDataWrapped =\n      object && object.__source && object.__source.parent && object.__source.parent.id === this.id;\n\n    if (!isDataWrapped) {\n      return info;\n    }\n\n    // override object with picked data\n    info.object = object.__source.object;\n    info.index = object.__source.index;\n\n    return info;\n  }\n\n  // Implement to generate subLayers\n  abstract renderLayers(): Layer | null | LayersList;\n\n  /**\n   * Filters sub layers at draw time. Return true if the sub layer should be drawn.\n   */\n  filterSubLayer(context: FilterContext): boolean {\n    return true;\n  }\n\n  /** Returns true if sub layer needs to be rendered */\n  protected shouldRenderSubLayer(subLayerId: string, data: any): boolean {\n    return data && data.length;\n  }\n\n  /** Returns sub layer class for a specific sublayer */\n  protected getSubLayerClass<T extends Layer>(\n    subLayerId: string,\n    DefaultLayerClass: ConstructorOf<T>\n  ): ConstructorOf<T> {\n    const {_subLayerProps: overridingProps} = this.props;\n\n    return (\n      (overridingProps &&\n        overridingProps[subLayerId] &&\n        (overridingProps[subLayerId].type as ConstructorOf<T>)) ||\n      DefaultLayerClass\n    );\n  }\n\n  /** When casting user data into another format to pass to sublayers,\n      add reference to the original object and object index */\n  protected getSubLayerRow<T>(row: T, sourceObject: any, sourceObjectIndex: number): T {\n    // @ts-ignore (TS2339) adding undefined property\n    row.__source = {\n      parent: this,\n      object: sourceObject,\n      index: sourceObjectIndex\n    };\n    return row;\n  }\n\n  /** Some composite layers cast user data into another format before passing to sublayers\n    We need to unwrap them before calling the accessor so that they see the original data\n    objects */\n  protected getSubLayerAccessor<In, Out>(accessor: Accessor<In, Out>): Accessor<In, Out> {\n    if (typeof accessor === 'function') {\n      const objectInfo: AccessorContext<In> = {\n        index: -1,\n        // @ts-ignore accessing resolved data\n        data: this.props.data,\n        target: []\n      };\n      return (x: any, i: AccessorContext<In>) => {\n        if (x && x.__source) {\n          objectInfo.index = x.__source.index;\n          // @ts-ignore (TS2349) Out is never a function\n          return accessor(x.__source.object as In, objectInfo);\n        }\n        // @ts-ignore (TS2349) Out is never a function\n        return accessor(x as In, i);\n      };\n    }\n    return accessor;\n  }\n\n  /** Returns sub layer props for a specific sublayer */\n  // eslint-disable-next-line complexity\n  protected getSubLayerProps(\n    sublayerProps: {\n      id?: string;\n      updateTriggers?: Record<string, any>;\n      [propName: string]: any;\n    } = {}\n  ): any {\n    const {\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      fetch,\n      operation,\n      _subLayerProps: overridingProps\n    } = this.props;\n    const newProps = {\n      id: '',\n      updateTriggers: {},\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      fetch,\n      operation\n    };\n\n    const overridingSublayerProps =\n      overridingProps && sublayerProps.id && overridingProps[sublayerProps.id];\n    const overridingSublayerTriggers =\n      overridingSublayerProps && overridingSublayerProps.updateTriggers;\n    const sublayerId = sublayerProps.id || 'sublayer';\n\n    if (overridingSublayerProps) {\n      const propTypes = this.props[PROP_TYPES_SYMBOL];\n      const subLayerPropTypes = sublayerProps.type ? sublayerProps.type._propTypes : {};\n      for (const key in overridingSublayerProps) {\n        const propType = subLayerPropTypes[key] || propTypes[key];\n        // eslint-disable-next-line\n        if (propType && propType.type === 'accessor') {\n          overridingSublayerProps[key] = this.getSubLayerAccessor(overridingSublayerProps[key]);\n        }\n      }\n    }\n\n    Object.assign(\n      newProps,\n      sublayerProps,\n      // experimental feature that allows users to override sublayer props via parent layer prop\n      overridingSublayerProps\n    );\n    newProps.id = `${this.props.id}-${sublayerId}`;\n    newProps.updateTriggers = {\n      all: this.props.updateTriggers?.all,\n      ...sublayerProps.updateTriggers,\n      ...overridingSublayerTriggers\n    };\n\n    // Pass through extension props\n    // @ts-ignore (TS2532) extensions is always defined after merging with default props\n    for (const extension of extensions) {\n      const passThroughProps = extension.getSubLayerProps.call(this, extension);\n      if (passThroughProps) {\n        Object.assign(newProps, passThroughProps, {\n          updateTriggers: Object.assign(newProps.updateTriggers, passThroughProps.updateTriggers)\n        });\n      }\n    }\n\n    return newProps;\n  }\n\n  /** Update sub layers to highlight the hovered object */\n  protected _updateAutoHighlight(info: PickingInfo): void {\n    for (const layer of this.getSubLayers()) {\n      layer.updateAutoHighlight(info);\n    }\n  }\n\n  /** Override base Layer method */\n  protected _getAttributeManager(): AttributeManager | null {\n    return null;\n  }\n\n  /** (Internal) Called after an update to rerender sub layers */\n  protected _postUpdate(updateParams: UpdateParameters<this>, forceUpdate: boolean) {\n    // @ts-ignore (TS2531) this method is only called internally when internalState is defined\n    let subLayers = this.internalState.subLayers as Layer[];\n    const shouldUpdate = !subLayers || this.needsUpdate();\n    if (shouldUpdate) {\n      const subLayersList = this.renderLayers();\n      // Flatten the returned array, removing any null, undefined or false\n      // this allows layers to render sublayers conditionally\n      // (see CompositeLayer.renderLayers docs)\n      subLayers = flatten(subLayersList, Boolean) as Layer[];\n      // @ts-ignore (TS2531) this method is only called internally when internalState is defined\n      this.internalState.subLayers = subLayers;\n    }\n    debug(TRACE_RENDER_LAYERS, this, shouldUpdate, subLayers);\n\n    // populate reference to parent layer (this layer)\n    // NOTE: needs to be done even when reusing layers as the parent may have changed\n    for (const layer of subLayers) {\n      layer.parent = this;\n    }\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { FilterXSS, getDefaultWhiteList } from 'xss';\n\nconst xssFilter = new FilterXSS({\n  whiteList: {\n    ...getDefaultWhiteList(),\n    span: ['style', 'class', 'title'],\n    div: ['style', 'class'],\n    a: ['style', 'class', 'href', 'title', 'target'],\n    img: ['style', 'class', 'src', 'alt', 'title', 'width', 'height'],\n    video: [\n      'autoplay',\n      'controls',\n      'loop',\n      'preload',\n      'src',\n      'height',\n      'width',\n      'muted',\n    ],\n  },\n  stripIgnoreTag: true,\n  css: false,\n});\n\nexport function sanitizeHtml(htmlString: string) {\n  return xssFilter.process(htmlString);\n}\n\nexport function isProbablyHTML(text: string) {\n  return Array.from(\n    new DOMParser().parseFromString(text, 'text/html').body.childNodes,\n  ).some(({ nodeType }) => nodeType === 1);\n}\n\nexport function sanitizeHtmlIfNeeded(htmlString: string) {\n  return isProbablyHTML(htmlString) ? sanitizeHtml(htmlString) : htmlString;\n}\n\nexport function safeHtmlSpan(possiblyHtmlString: string) {\n  const isHtml = isProbablyHTML(possiblyHtmlString);\n  if (isHtml) {\n    return (\n      <span\n        className=\"safe-html-wrapper\"\n        dangerouslySetInnerHTML={{ __html: sanitizeHtml(possiblyHtmlString) }}\n      />\n    );\n  }\n  return possiblyHtmlString;\n}\n\nexport function removeHTMLTags(str: string): string {\n  return str.replace(/<[^>]*>/g, '');\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled, safeHtmlSpan } from '@superset-ui/core';\nimport React, { ReactNode } from 'react';\n\nexport type TooltipProps = {\n  tooltip:\n    | {\n        x: number;\n        y: number;\n        content: ReactNode;\n      }\n    | null\n    | undefined;\n};\n\nconst StyledDiv = styled.div<{ top: number; left: number }>`\n  ${({ theme, top, left }) => `\n    position: absolute;\n    top: ${top}px;\n    left: ${left}px;\n    padding: ${theme.gridUnit * 2}px;\n    margin: ${theme.gridUnit * 2}px;\n    background: ${theme.colors.grayscale.dark2};\n    color: ${theme.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${theme.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}\n`;\n\nexport default function Tooltip(props: TooltipProps) {\n  const { tooltip } = props;\n  if (typeof tooltip === 'undefined' || tooltip === null) {\n    return null;\n  }\n\n  const { x, y, content } = tooltip;\n  const safeContent =\n    typeof content === 'string' ? safeHtmlSpan(content) : content;\n\n  return (\n    <StyledDiv top={y} left={x}>\n      {safeContent}\n    </StyledDiv>\n  );\n}\n","/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  forwardRef,\n  memo,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { isEqual } from 'lodash';\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL, { Layer } from 'deck.gl/typed';\nimport { JsonObject, JsonValue, styled, usePrevious } from '@superset-ui/core';\nimport Tooltip, { TooltipProps } from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { Viewport } from './utils/fitViewport';\n\nconst TICK = 250; // milliseconds\n\nexport type DeckGLContainerProps = {\n  viewport: Viewport;\n  setControlValue?: (control: string, value: JsonValue) => void;\n  mapStyle?: string;\n  mapboxApiAccessToken: string;\n  children?: ReactNode;\n  width: number;\n  height: number;\n  layers: (Layer | (() => Layer))[];\n  onViewportChange?: (viewport: Viewport) => void;\n};\n\nexport const DeckGLContainer = memo(\n  forwardRef((props: DeckGLContainerProps, ref) => {\n    const [tooltip, setTooltip] = useState<TooltipProps['tooltip']>(null);\n    const [lastUpdate, setLastUpdate] = useState<number | null>(null);\n    const [viewState, setViewState] = useState(props.viewport);\n    const prevViewport = usePrevious(props.viewport);\n\n    useImperativeHandle(ref, () => ({ setTooltip }), []);\n\n    const tick = useCallback(() => {\n      // Rate limiting updating viewport controls as it triggers lots of renders\n      if (lastUpdate && Date.now() - lastUpdate > TICK) {\n        const setCV = props.setControlValue;\n        if (setCV) {\n          setCV('viewport', viewState);\n        }\n        setLastUpdate(null);\n      }\n    }, [lastUpdate, props.setControlValue, viewState]);\n\n    useEffect(() => {\n      const timer = setInterval(tick, TICK);\n      return clearInterval(timer);\n    }, [tick]);\n\n    useEffect(() => {\n      if (!isEqual(props.viewport, prevViewport)) {\n        setViewState(props.viewport);\n      }\n    }, [prevViewport, props.viewport]);\n\n    const onViewStateChange = useCallback(\n      ({ viewState }: { viewState: JsonObject }) => {\n        setViewState(viewState as Viewport);\n        setLastUpdate(Date.now());\n      },\n      [],\n    );\n\n    const layers = useCallback(() => {\n      // Support for layer factory\n      if (props.layers.some(l => typeof l === 'function')) {\n        return props.layers.map(l =>\n          typeof l === 'function' ? l() : l,\n        ) as Layer[];\n      }\n\n      return props.layers as Layer[];\n    }, [props.layers]);\n\n    const { children = null, height, width } = props;\n\n    return (\n      <>\n        <div style={{ position: 'relative', width, height }}>\n          <DeckGL\n            controller\n            width={width}\n            height={height}\n            layers={layers()}\n            viewState={viewState}\n            glOptions={{ preserveDrawingBuffer: true }}\n            onViewStateChange={onViewStateChange}\n          >\n            <StaticMap\n              preserveDrawingBuffer\n              mapStyle={props.mapStyle || 'light'}\n              mapboxApiAccessToken={props.mapboxApiAccessToken}\n            />\n          </DeckGL>\n          {children}\n        </div>\n        <Tooltip tooltip={tooltip} />\n      </>\n    );\n  }),\n);\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n\nexport type DeckGLContainerHandle = typeof DeckGLContainer & {\n  setTooltip: (tooltip: ReactNode) => void;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\ntype TooltipRowProps = {\n  label: string;\n  value: string;\n};\n\nconst TooltipRow = ({ label, value }: TooltipRowProps) => (\n  <div>\n    {label}\n    <strong>{value}</strong>\n  </div>\n);\n\nexport default TooltipRow;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { memo, useCallback, useMemo, useRef } from 'react';\nimport { GeoJsonLayer } from 'deck.gl/typed';\nimport geojsonExtent from '@mapbox/geojson-extent';\nimport {\n  HandlerFunction,\n  JsonObject,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\n\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../../DeckGLContainer';\nimport { hexToRGB } from '../../utils/colors';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\nimport fitViewport, { Viewport } from '../../utils/fitViewport';\nimport { TooltipProps } from '../../components/Tooltip';\n\nconst propertyMap = {\n  fillColor: 'fillColor',\n  color: 'fillColor',\n  fill: 'fillColor',\n  'fill-color': 'fillColor',\n  strokeColor: 'strokeColor',\n  'stroke-color': 'strokeColor',\n  'stroke-width': 'strokeWidth',\n};\n\nconst alterProps = (props: JsonObject, propOverrides: JsonObject) => {\n  const newProps: JsonObject = {};\n  Object.keys(props).forEach(k => {\n    if (k in propertyMap) {\n      newProps[propertyMap[k]] = props[k];\n    } else {\n      newProps[k] = props[k];\n    }\n  });\n  if (typeof props.fillColor === 'string') {\n    newProps.fillColor = hexToRGB(props.fillColor);\n  }\n  if (typeof props.strokeColor === 'string') {\n    newProps.strokeColor = hexToRGB(props.strokeColor);\n  }\n\n  return {\n    ...newProps,\n    ...propOverrides,\n  };\n};\nlet features: JsonObject[];\nconst recurseGeoJson = (\n  node: JsonObject,\n  propOverrides: JsonObject,\n  extraProps?: JsonObject,\n) => {\n  if (node?.features) {\n    node.features.forEach((obj: JsonObject) => {\n      recurseGeoJson(obj, propOverrides, node.extraProps || extraProps);\n    });\n  }\n  if (node?.geometry) {\n    const newNode = {\n      ...node,\n      properties: alterProps(node.properties, propOverrides),\n    } as JsonObject;\n    if (!newNode.extraProps) {\n      newNode.extraProps = extraProps;\n    }\n    features.push(newNode);\n  }\n};\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    o.object?.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps?.[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nconst getFillColor = (feature: JsonObject) => feature?.properties?.fillColor;\nconst getLineColor = (feature: JsonObject) => feature?.properties?.strokeColor;\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: HandlerFunction,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const fc = fd.fill_color_picker;\n  const sc = fd.stroke_color_picker;\n  const fillColor = [fc.r, fc.g, fc.b, 255 * fc.a];\n  const strokeColor = [sc.r, sc.g, sc.b, 255 * sc.a];\n  const propOverrides: JsonObject = {};\n  if (fillColor[3] > 0) {\n    propOverrides.fillColor = fillColor;\n  }\n  if (strokeColor[3] > 0) {\n    propOverrides.strokeColor = strokeColor;\n  }\n\n  features = [];\n  recurseGeoJson(payload.data, propOverrides);\n\n  let jsFnMutator;\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    features = jsFnMutator(features);\n  }\n\n  return new GeoJsonLayer({\n    id: `geojson-layer-${fd.slice_id}` as const,\n    data: features,\n    extruded: fd.extruded,\n    filled: fd.filled,\n    stroked: fd.stroked,\n    getFillColor,\n    getLineColor,\n    getLineWidth: fd.line_width || 1,\n    pointRadiusScale: fd.point_radius_scale,\n    lineWidthUnits: fd.line_width_unit,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nexport type DeckGLGeoJsonProps = {\n  formData: QueryFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  onAddFilter: HandlerFunction;\n  height: number;\n  width: number;\n};\n\nconst DeckGLGeoJson = (props: DeckGLGeoJsonProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const { formData, payload, setControlValue, onAddFilter, height, width } =\n    props;\n\n  const viewport: Viewport = useMemo(() => {\n    if (formData.autozoom) {\n      const points =\n        payload?.data?.features?.reduce?.(\n          (acc: [number, number, number, number][], feature: any) => {\n            const bounds = geojsonExtent(feature);\n            if (bounds) {\n              return [...acc, [bounds[0], bounds[1]], [bounds[2], bounds[3]]];\n            }\n\n            return acc;\n          },\n          [],\n        ) || [];\n\n      if (points.length) {\n        return fitViewport(props.viewport, {\n          width,\n          height,\n          points,\n        });\n      }\n    }\n    return props.viewport;\n  }, [\n    formData.autozoom,\n    height,\n    payload?.data?.features,\n    props.viewport,\n    width,\n  ]);\n\n  const layer = getLayer(formData, payload, onAddFilter, setTooltip);\n\n  return (\n    <DeckGLContainerStyledWrapper\n      ref={containerRef}\n      mapboxApiAccessToken={payload.data.mapboxApiKey}\n      viewport={viewport}\n      layers={[layer]}\n      mapStyle={formData.mapbox_style}\n      setControlValue={setControlValue}\n      height={height}\n      width={width}\n    />\n  );\n};\n\nexport default memo(DeckGLGeoJson);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport * as d3array from 'd3-array';\nimport { JsonObject, JsonValue, QueryFormData } from '@superset-ui/core';\nimport sandboxedEval from '../utils/sandbox';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport function commonLayerProps(\n  formData: QueryFormData,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  setTooltipContent: (content: JsonObject) => ReactNode,\n  onSelect?: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o: JsonObject) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o: any) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o: any) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(\n  type = 'sum',\n  accessor: ((object: any) => number | undefined) | null = null,\n) {\n  if (type === 'count') {\n    return (arr: number[]) => arr.length;\n  }\n  let d3func: (\n    iterable: Array<unknown>,\n    accessor?: (object: JsonObject) => number | undefined,\n  ) => number[] | number | undefined;\n  if (type in percentiles) {\n    d3func = (arr, acc: (object: JsonObject) => number | undefined) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1: JsonObject, o2: JsonObject) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr: JsonObject[]) => d3func(arr);\n  }\n\n  return (arr: JsonObject[]) => d3func(arr.map(x => accessor(x)));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { rgb } from 'd3-color';\n\n// eslint-disable-next-line import/prefer-default-export\nexport function hexToRGB(\n  hex: string | undefined,\n  alpha = 255,\n): [number, number, number, number] {\n  if (!hex) {\n    return [0, 0, 0, alpha];\n  }\n  const { r, g, b } = rgb(hex);\n\n  return [r, g, b, alpha];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { extent as d3Extent } from 'd3-array';\nimport { Point, Range } from '../types';\n\nconst LAT_LIMIT: Range = [-90, 90];\nconst LNG_LIMIT: Range = [-180, 180];\n\n/**\n * Expand a coordinate range by `padding` and within limits, if needed\n */\nfunction expandIfNeeded(\n  [curMin, curMax]: Range,\n  [minBound, maxBound]: Range,\n  padding = 0.25,\n) {\n  return curMin < curMax\n    ? [curMin, curMax]\n    : [\n        Math.max(minBound, curMin - padding),\n        Math.min(maxBound, curMax + padding),\n      ];\n}\n\nexport default function computeBoundsFromPoints(\n  points: Point[],\n): [Point, Point] {\n  const latBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[1]) as Range,\n    LAT_LIMIT,\n  );\n  const lngBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[0]) as Range,\n    LNG_LIMIT,\n  );\n  return [\n    [lngBounds[0], latBounds[0]],\n    [lngBounds[1], latBounds[1]],\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { fitBounds } from '@math.gl/web-mercator';\nimport computeBoundsFromPoints from './computeBoundsFromPoints';\nimport { Point } from '../types';\n\nexport type Viewport = {\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  bearing?: number;\n  pitch?: number;\n};\n\nexport type FitViewportOptions = {\n  points: Point[];\n  width: number;\n  height: number;\n  minExtent?: number;\n  maxZoom?: number;\n  offset?: [number, number];\n  padding?: number;\n};\n\nexport default function fitViewport(\n  originalViewPort: Viewport,\n  {\n    points,\n    width,\n    height,\n    minExtent,\n    maxZoom,\n    offset,\n    padding = 20,\n  }: FitViewportOptions,\n): Viewport {\n  const { bearing, pitch } = originalViewPort;\n  const bounds = computeBoundsFromPoints(points);\n\n  try {\n    return {\n      ...fitBounds({\n        bounds,\n        width,\n        height,\n        minExtent,\n        maxZoom,\n        offset,\n        padding,\n      }),\n      bearing,\n      pitch,\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Could not fit viewport', error);\n  }\n\n  return originalViewPort;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// A safe alternative to JS's eval\nimport vm, { Context, RunningScriptOptions } from 'vm';\nimport _ from 'underscore';\nimport * as d3array from 'd3-array';\nimport * as colors from './colors';\n\n// Objects exposed here should be treated like a public API\n// if `underscore` had backwards incompatible changes in a future release, we'd\n// have to be careful about bumping the library as those changes could break user charts\nconst GLOBAL_CONTEXT = {\n  console,\n  _,\n  colors,\n  d3array,\n};\n\n// Copied/modified from https://github.com/hacksparrow/safe-eval/blob/master/index.js\nexport default function sandboxedEval(\n  code: string,\n  context?: Context,\n  opts?: RunningScriptOptions | string,\n) {\n  const sandbox = {};\n  const resultKey = `SAFE_EVAL_${Math.floor(Math.random() * 1000000)}`;\n  sandbox[resultKey] = {};\n  const codeToEval = `${resultKey}=${code}`;\n  const sandboxContext = { ...GLOBAL_CONTEXT, ...context };\n  Object.keys(sandboxContext).forEach(key => {\n    sandbox[key] = sandboxContext[key];\n  });\n  try {\n    vm.runInNewContext(codeToEval, sandbox, opts);\n\n    return sandbox[resultKey];\n  } catch (error) {\n    return () => error;\n  }\n}\n"],"names":["CompositeLayer","Layer","isComposite","isLoaded","super","this","getSubLayers","every","layer","internalState","subLayers","initializeState","context","setState","updateObject","setNeedsUpdate","getPickingInfo","info","object","__source","parent","id","index","filterSubLayer","shouldRenderSubLayer","subLayerId","data","length","getSubLayerClass","DefaultLayerClass","_subLayerProps","overridingProps","props","type","getSubLayerRow","row","sourceObject","sourceObjectIndex","getSubLayerAccessor","accessor","objectInfo","target","x","i","getSubLayerProps","sublayerProps","_this$props$updateTri","opacity","pickable","visible","parameters","getPolygonOffset","highlightedObjectIndex","autoHighlight","highlightColor","coordinateSystem","coordinateOrigin","wrapLongitude","positionFormat","modelMatrix","extensions","fetch","operation","newProps","updateTriggers","overridingSublayerProps","overridingSublayerTriggers","sublayerId","propTypes","PROP_TYPES_SYMBOL","subLayerPropTypes","_propTypes","key","propType","Object","assign","concat","all","extension","passThroughProps","call","_updateAutoHighlight","updateAutoHighlight","_getAttributeManager","_postUpdate","updateParams","forceUpdate","shouldUpdate","needsUpdate","subLayersList","renderLayers","flatten","Boolean","debug","xssFilter","FilterXSS","whiteList","getDefaultWhiteList","span","div","a","img","video","stripIgnoreTag","css","sanitizeHtml","htmlString","process","isProbablyHTML","text","Array","from","DOMParser","parseFromString","body","childNodes","some","nodeType","sanitizeHtmlIfNeeded","safeHtmlSpan","possiblyHtmlString","___EmotionJSX","className","dangerouslySetInnerHTML","__html","removeHTMLTags","str","replace","StyledDiv","styled","theme","top","left","gridUnit","colors","grayscale","dark2","light5","typography","sizes","s","Tooltip","tooltip","y","content","safeContent","DeckGLContainer","memo","forwardRef","ref","setTooltip","useState","lastUpdate","setLastUpdate","viewState","setViewState","viewport","prevViewport","usePrevious","useImperativeHandle","tick","useCallback","Date","now","setCV","setControlValue","useEffect","timer","setInterval","clearInterval","_isEqual","onViewStateChange","layers","l","map","children","height","width","React","style","position","DeckGL","controller","glOptions","preserveDrawingBuffer","StaticMap","mapStyle","mapboxApiAccessToken","DeckGLContainerStyledWrapper","TooltipRow","label","value","propertyMap","fillColor","color","fill","strokeColor","alterProps","propOverrides","keys","forEach","k","hexToRGB","features","recurseGeoJson","node","extraProps","obj","geometry","newNode","properties","push","setTooltipContent","o","_o$object","prop","_o$object$extraProps","getFillColor","feature","_feature$properties","getLineColor","_feature$properties2","getLayer","formData","payload","onAddFilter","fd","fc","fill_color_picker","sc","stroke_color_picker","r","g","b","jsFnMutator","js_data_mutator","sandboxedEval","GeoJsonLayer","slice_id","extruded","filled","stroked","getLineWidth","line_width","pointRadiusScale","point_radius_scale","lineWidthUnits","line_width_unit","commonLayerProps","DeckGLGeoJson","_payload$data2","containerRef","useRef","current","useMemo","autozoom","_payload$data","_payload$data$feature","points","reduce","acc","bounds","geojsonExtent","fitViewport","mapboxApiKey","mapbox_style","onSelect","onHover","onClick","tooltipContentGenerator","js_tooltip","picked","js_onclick_href","href","window","open","table_filter","undefined","line_column","percentiles","p1","p5","p95","p99","getAggFunc","arr","d3func","sortedArr","sort","o1","o2","d3array","hex","alpha","rgb","LAT_LIMIT","LNG_LIMIT","expandIfNeeded","curMin","curMax","minBound","maxBound","padding","Math","max","min","originalViewPort","minExtent","maxZoom","offset","bearing","pitch","latBounds","d3Extent","lngBounds","computeBoundsFromPoints","fitBounds","error","console","GLOBAL_CONTEXT","_","code","opts","sandbox","resultKey","floor","random","codeToEval","sandboxContext","vm"],"sourceRoot":""}